<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 3. stratcond</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Reconnoiter"><link rel="up" href="pt01.html" title="Part I. Architecture"><link rel="prev" href="arch.noitd.html" title="Chapter 2. noitd"><link rel="next" href="configuration.html" title="Part II. Configuration"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 3. stratcond</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="arch.noitd.html">Prev</a> </td><th width="60%" align="center">Part I. Architecture</th><td width="20%" align="right"> <a accesskey="n" href="configuration.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="arch.stratcond"></a>Chapter 3. stratcond</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="arch.stratcond.html#arch.stratcond.design">stratcond Design</a></span></dt></dl></div>
  
  <p>
    <span class="command"><strong>stratcond</strong></span> is responsible for pulling collected metrics 
    from <span class="command"><strong>noitd</strong></span> processes running in the field.  It will 
    connect to <span class="command"><strong>noitd</strong></span> over an SSL-protected TCP transport on 
    port 34332 (or another port of your choosing), then 
    <span class="command"><strong>noitd</strong></span> will push a dataset to 
    <span class="command"><strong>stratcond</strong></span>.  <span class="command"><strong>stratcond</strong></span> will transform 
    this dataset and insert it into the PostgreSQL datastore.
  </p>
  <p>
    Data collected by <span class="command"><strong>noitd</strong></span> is stored in a jlog journal 
    which is a segment-based, publish-subscribe journal.  Adhering to the 
    publish-subscribe model, <span class="command"><strong>stratcond</strong></span> must be a subscriber 
    to this log and the common name (CN) in the client-side SSL certificate 
    that <span class="command"><strong>stratcond</strong></span> presents to <span class="command"><strong>noitd</strong></span> upon 
    connecting is used as the jlog subscriber name.
  </p>
  <p> See the <a class="ulink" href="https://github.com/omniti-labs/jlog/" target="_top"><em class="citetitle">JLog</em></a> project
    page for more information about JLog. </p>
  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="arch.stratcond.design"></a>stratcond Design</h2></div></div></div>
    
    <p>
      <span class="command"><strong>stratcond</strong></span> is simple in both purpose and design.  All 
      connections to remote <span class="command"><strong>noitd</strong></span> deamons are managed in a 
      single thread in the event system.  As data is received from each 
      <span class="command"><strong>noitd</strong></span> daemon, it is pushed onto a datastore queue for 
      that daemon.  A database connection is established for each 
      <span class="command"><strong>noitd</strong></span> daemon (each in its own thread) and those 
      threads consume the datastore queue, transforming and inserting data into 
      PostgreSQL.
    </p>
    <p>
      Inserts are performed in batches.  At the end of each batch, 
      <span class="command"><strong>stratcond</strong></span> will commit the database transaction and 
      advise the the remote <span class="command"><strong>noitd</strong></span> to checkpoint the 
      subscriber position.  This two-point commit is not XA-safe and there is 
      a possibility that data could be committed to the datastore and the 
      subscriber checkpoint not be updated.  This will result in an attempt to 
      repeat the data insertion, resulting in primary key violations which are 
      ignored.
    </p>
    <p>
      <span class="command"><strong>stratcond</strong></span> uses the same configuration processing 
      system as <span class="command"><strong>noitd</strong></span>.  It is XML-based and provides 
      facilities for defining the SQL statements executed against PostgreSQL, 
      the connection parameters, and the various remote 
      <span class="command"><strong>noitd</strong></span> instances to which it should connect.
    </p>
  </div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="arch.noitd.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="pt01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="configuration.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 2. noitd </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Part II. Configuration</td></tr></table></div></body></html>
